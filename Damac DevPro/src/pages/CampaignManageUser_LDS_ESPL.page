<apex:page id="myPage" standardController="Campaign__c" extensions="CampaignManageUsersControl" docType="html-5.0" standardStylesheets="true" sidebar="true" showHeader="true" >
 <apex:slds />
    <!-- jQuery CDN 
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>-->
    <script>
        function overridePageMessages(){    
            var textureEffect = '';
            //Uncomment below line for texture effect on page messages
            textureEffect = 'slds-theme--alert-texture';

            $('.warningM3').addClass('slds-notify slds-notify--toast slds-theme--warning customMessage '+textureEffect);          
            $('.confirmM3').addClass('slds-notify slds-notify--alert slds-theme--success  customMessage '+textureEffect);    
            $('.errorM3').addClass('slds-notify slds-notify--alert slds-theme--error customMessage '+textureEffect);                  
            $('.infoM3').addClass('slds-notify slds-notify--toast customMessage '+textureEffect);    
                     
            $('.errorM3').removeClass('errorM3'); 
            $('.confirmM3').removeClass('confirmM3'); 
            $('.infoM3').removeClass('infoM3');   
            $('.warningM3').removeClass('warningM3');  
        }
    </script>
    <style>
        /* This is for the apex page message override*/
        .msgIcon {
                display: none!important
        }
        .customMessage * {
            color: #fff!important
        }
        .customMessage {
            margin: 5px 0!important;
            max-width: 1280px;
            opacity: 1!important;
            width: 100%;
            font-size: 12px;
            border: 0px;
            padding-left: 10px;
        }
        .message {
            opacity: .1
        }
        .fontClass{
            color: #000; 
            font-size: .9em; 
            font-weight: bold;
        }
        .selectWidth {
            width: 90% !important;
        }
        .slds-panel__section {
            padding-left:0px !important;
            padding-right:0px !important;
        }
        #searchTable td {
            vertical-align: middle !important;
            padding : 0.2% !important;
        }
    </style>
    <apex:includeScript value="{!$Resource.jQuery_Lib}"/>
    <apex:includeScript value="{!$Resource.jQuery_UI_JS}"/>
    <apex:stylesheet value="{!$Resource.jQuery_UI_CSS}"/>
    <style type="text/css">
        .fontClass{
            color: #000; 
            font-size: .9em; 
            font-weight: bold;
        }
        /* This is for the full screen DIV */
        .overlay {
            background-color: black;
            cursor: wait;
            opacity: 0.6;
            /* Generic for Major browsers */
            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=60)";
            /* IE 5-7 */
            filter: alpha(opacity = 60);
            /* Netscape */
            -moz-opacity: 0.6;
            /* Safari 1.x */
            -khtml-opacity: 0.6;
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 101;
            zIndex: 101;
        }
        
        /* This is for the message DIV */
        .contentDiv {
            position: fixed;
            z-index: 102;
            top: 30%;
            right: 25%;
            left: 25%;
        }
    </style>
    <apex:form styleClass="slds-form" id="myForm">
        <apex:pageBlock html-class="slds-panel" id="PB" title="Select Property Consultants">
            <apex:pageBlockButtons styleClass="slds-button" id="PBB" location="top">
                <!--onclick="if(!validations()){return false};" -->
                <apex:commandButton styleClass="slds-button slds-button--neutral" status="myStatus" onclick="if(!validations()){return false};" action="{!getAllAgencies}" value="Save" rerender="pop_upSection,scriptTag"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Add All PCs" status="myStatus" onclick="if(!confirm('Are you sure want to add all PCs to Campaign?')){return false};" action="{!assignAllPCsToCampaign}" reRender="PB"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" action="{!doCancel}" value="Cancel" rendered="{!NOT(manageHelper.isSaved)}" immediate="true"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" action="{!doCancel}" value="Back to Campaign" rendered="{!manageHelper.isSaved}" immediate="true"/>
            </apex:pageBlockButtons>
            <apex:outputPanel styleClass="slds-panel" id="seachSection">
                <apex:pageBlockSection html-class="slds-panel__section" title="Filters" collapsible="false" />
                <Table id="searchTable" width="90%" style="background-color:#F8F8F8;">
                    <tr>
                        <td align="right"><apex:outputLabel id="pcName" styleClass="fontClass" value="PC Name"/></td>
                        <td>
                            <apex:inputText styleClass="slds-input" style="width:90%;" value="{!manageHelper.selectedText}" id="countryautocomplete"/>
                        </td>
                        <td align="right"><apex:outputLabel styleClass="fontClass" id="hos" value="HOS"/></td>
                        <td>
                            <apex:inputText styleClass="slds-input" style="width:90%;" value="{!searchSection.HOS__c}" id="hosautoComplete"/>
                        </td>
                        <td align="right"><apex:outputLabel styleClass="fontClass" id="dos" value="DOS"/></td>
                        <td>
                            <apex:inputText styleClass="slds-input" style="width:90%;" value="{!searchSection.DOS__c}" id="dosautoComplete"/>
                        </td>
                    </tr>
                    <tr>                            
                        <td align="right"><apex:outputLabel styleClass="fontClass" id="pcLan" value=" PC Language"/></td>   
                        <td><apex:inputField styleClass="slds-input selectWidth" id="pcLanVal" value="{!searchSection.PC_Languages__c}"/></td>                            
                        <!--<td align="right"><apex:outputLabel styleClass="fontClass" id="pcNat" value="PC Country"/></td>
                        <td><apex:inputField styleClass="slds-input" id="pcNatVal" value="{!searchSection.PC_Nationality__c}"/></td>-->
                        <td align="right"><apex:outputLabel styleClass="fontClass" id="team" value="Team"/></td>
                        <td>
                            <apex:selectList styleClass="slds-select selectWidth" size="1" value="{!searchSection.Team__c}">
                                <apex:selectOptions value="{!teamNames}"></apex:selectOptions>
                            </apex:selectList>                            
                        </td>
                        <td align="right"><apex:outputLabel styleClass="fontClass" id="SalesOfficelabel" value="Sales Office"/></td>
                        <td> <!-- Added by Subhash on may 21 2017 on Riddhis Instructions -->
                            <apex:inputField styleClass="slds-input selectWidth" id="salesOffice" value="{!searchSection.Sales_Office__c}"/>
                        </td>
                    </tr>                        
                </Table>
            </apex:outputPanel>
            
            <table border="0" width="70%">
                <tr>
                    <td align="center" colspan="2">
                        <div align="center">
                        <apex:commandButton styleClass="slds-button slds-button--neutral" id="search" value="Search"  action="{!searchUsers}"  status="myStatus" reRender="myForm,scriptTag"/>
                        </div>
                    </td>
                </tr>
                <tr colspan="2"> 
                       <br/> 
                </tr>
                <tr >
                        <td>
                            <apex:outputLabel id="mstart" styleClass="fontClass" Style="margin-right:15px;" value="Marketing Start Date : "/>  
                            <apex:outputField id="mStartDate" styleClass="slds-text-body_regular"  Style="margin-left:20px;margin-right:20px;" value="{!Campaign__c.Marketing_Start_Date__c}" /> + 
                            &nbsp;<apex:inputText styleClass="slds-input" style="width:20%" id="incrStartDate" value="{!dMStartDate}" ></apex:inputText>
                        </td>
                        <td>
                            <apex:outputLabel id="mEnd" styleClass="fontClass" Style="margin-right:15px;" value="Marketing End Date : "/>
                            <apex:outputField id="mEndDate" styleClass="slds-text-body_regular"  Style="margin-left:20px;margin-right:20px;" value="{!Campaign__c.Marketing_End_Date__c}" /> - 
                            &nbsp;<apex:inputText styleClass="slds-input" style="width:20%" id="incrEndDate" value="{!dMEndDate}" ></apex:inputText>
                        </td>   
                        
                </tr>
            </table>
            
            <apex:actionStatus id="myStatus">
                <apex:facet name="start">
                    <div>
                        <div class="slds-spinner_container" style="position: fixed;">
                            <div role="status" class="slds-spinner slds-spinner--large slds-spinner--brand" >
                                <span class="slds-assistive-text">Please Wait...</span>
                                <div class="slds-spinner__dot-a"></div>
                                <div class="slds-spinner__dot-b"></div>
                            </div>
                        </div>
                    </div>
                </apex:facet>
            </apex:actionStatus>
            
            <apex:pageBlockSection html-class="slds-panel__section" id="PBS" title="Search Results" columns="1" collapsible="false">
                <apex:pageMessages />
                <apex:pageBlockTable styleClass="slds-table slds-table--bordered slds-table--cell-buffer" id="searchResults" value="{!lstofPCProfielUser}" var="pcUser">
                    <apex:column width="40px" id="selID" headerValue="Select">
                        <apex:facet name="header">
                            <span class="slds-checkbox">
                                <input type="checkbox" name="options" id="allSelect" value="on" onchange="toggleSelectAll(this);" />
                                <label class="slds-checkbox__label" for="allSelect">
                                    <span class="slds-checkbox_faux"></span>
                                    <span class="slds-form-element__label"></span>
                                </label>
                            </span>
                            <!--<input type="checkbox" id="parentCheck" onclick="toggleSelectAll(this);"/>-->
                        </apex:facet>
                        <div class="slds-form-element__row">
                            <div class="slds-form-element">
                              <label class="slds-checkbox">
                                    <apex:inputcheckbox styleclass="slds-input oneSelect" value="{!pcUser.checked}" onchange="toggleItem();" />
                                       <span class="slds-checkbox--faux"></span>
                              </label>
                            </div>
                        </div>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <apex:outputLink styleClass="slds-text-link" target="_blank" value="/{!pcUser.obj['Id']}">{!pcUser.obj['Name']}</apex:outputLink>
                    </apex:column>
                    <apex:column value="{!pcUser.obj['UserName']}"/>
                    <apex:column value="{!pcUser.obj['Languages_Known__c']}"/>
                    <apex:column value="{!pcUser.obj['DOS_Name__c']}"/>
                    <apex:column value="{!pcUser.obj['HOS_Name__c']}"/>
                    <apex:column value="{!pcUser.obj['HOD_Name__c']}"/>
                    
                    <!--
                    <apex:column headerValue="Start Date">
                        <apex:outputPanel styleClass="slds-panel" layout="block" >
                            <apex:outputPanel styleClass="slds-panel" layout="block"/>
                            <apex:inputField id="startDate" styleClass="slds-input" value="{!pcUser.assignedPC.Start_Date__c}" />
                        </apex:outputPanel>
                        
                    </apex:column>
                    <apex:column headerValue="End Date">
                        <apex:outputPanel styleClass="slds-panel" layout="block" >
                            <apex:outputPanel styleClass="slds-panel" layout="block"/>
                            <apex:inputField id="endDate" styleClass="slds-input" value="{!pcUser.assignedPC.End_Date__c}" />
                        </apex:outputPanel>
                        
                    </apex:column>-->
                </apex:pageBlockTable>
            </apex:pageBlockSection> 
            <div align="center">
                <apex:commandButton styleClass="slds-button slds-button--neutral" value="First" action="{!first}" status="myStatus" disabled="{!NOT(manageHelper.hasPrevious)}" reRender="myForm" immediate="true"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Previous" action="{!previous}" status="myStatus" disabled="{!NOT(manageHelper.hasPrevious)}" reRender="myForm" immediate="true"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Next" action="{!next}" status="myStatus" disabled="{!NOT(manageHelper.hasNext)}"  reRender="myForm" immediate="true"/>
                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Last" action="{!last}" status="myStatus" disabled="{!NOT(manageHelper.hasNext)}" reRender="myForm" immediate="true"/>
                <apex:outputLabel style="margin-left:15px;" value="Page #" >{!manageHelper.pageNumber}</apex:outputLabel>
            </div>
            <!--<apex:panelGrid columns="4"> 
                <apex:commandLink styleClass="slds-button slds-button--neutral" action="{!first}" immediate="true" reRender="myForm">First</apex:commandlink>
                <apex:commandLink styleClass="slds-button slds-button--neutral" action="{!previous}" rendered="{!manageHelper.hasPrevious}" immediate="true" reRender="myForm">Previous</apex:commandlink>
                <apex:commandLink styleClass="slds-button slds-button--neutral" action="{!next}" rendered="{!manageHelper.hasNext}" immediate="true" reRender="myForm">Next</apex:commandlink>
                <apex:commandLink styleClass="slds-button slds-button--neutral" action="{!last}" immediate="true" reRender="myForm">Last</apex:commandlink>
                <apex:outputLabel style="margin-left:15px;" value="Page #">{!manageHelper.pageNumber}</apex:outputLabel>
            </apex:panelGrid>-->
            <!--Pop-up section-->
            <apex:outputPanel styleClass="slds-panel" id="pop_upSection" >
                <apex:outputPanel styleClass="slds-panel" rendered="{!showPopup}">
                    <div class="overlay"></div>
                    <apex:outputPanel styleClass="slds-panel">
                        <apex:pageBlock html-class="slds-panel" >
                            <apex:pageBlockButtons styleClass="slds-button" location="top">
                                <apex:commandButton styleClass="slds-button slds-button--neutral" status="myStatus" action="{!createCampaignUsersNew}" value="{!IF(lstSelectedAgencies.size = 0,'Continue','Save')}" rerender="myForm,scriptTag,pop_upSection" />
                                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Cancel" action="{!cancel}" reRender="pop_upSection" rendered="{!NOT(manageHelper.isSaved)}" rerender="myForm"/>
                                <apex:commandButton styleClass="slds-button slds-button--neutral" value="Back to Campaign" action="{!doCancel}" rendered="{!manageHelper.isSaved}"/>
                            </apex:pageBlockButtons>
                            <apex:pageMessages />
                            <apex:pageMessage detail="No Agencies are allocated to selected PCs." summary="" severity="info" strength="2" rendered="{!IF(lstSelectedAgencies.size = 0,true,false)}"/>
                            <apex:pageBlockSection html-class="slds-panel__section" title="Selected Agencies" collapsible="false" rendered="{!IF(lstSelectedAgencies.size > 0,true,false)}">
                                <apex:pageBlockTable styleClass="slds-table slds-table--bordered slds-table--cell-buffer" value="{!lstSelectedAgencies}" var="ag" >
                                    <apex:column width="40px" id="selID" headerValue="Select">
                                        <apex:facet name="header">
                                            <span class="slds-checkbox">
                                                <input type="checkbox" name="options" id="allSelectAgency" value="on" onchange="toggleSelectAllAgency(this);" />
                                                <label class="slds-checkbox__label" for="allSelectAgency">
                                                    <span class="slds-checkbox_faux"></span>
                                                    <span class="slds-form-element__label"></span>
                                                </label>
                                            </span>
                                            <!--<input type="checkbox" id="parentCheck" onclick="toggleSelectAll(this);"/>-->
                                        </apex:facet>
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element">
                                              <label class="slds-checkbox">
                                                    <apex:inputcheckbox styleclass="slds-input oneSelectAgent" value="{!ag.checked}" onchange="toggleItemAgency();" />
                                                       <span class="slds-checkbox--faux"></span>
                                              </label>
                                            </div>
                                        </div>
                                    </apex:column>
                                    <apex:column headerValue="Agency Name">
                                        <apex:outputLink styleClass="slds-text-link" target="_blank" value="/{!ag.obj['Agency__c']}">{!ag.obj['Agency__r.Name']}</apex:outputLink>
                                    </apex:column>
                                </apex:pageBlockTable>
                            </apex:pageBlockSection>
                        </apex:pageBlock>
                    </apex:outputPanel>
                </apex:outputPanel>
            </apex:outputPanel>
        </apex:pageBlock>
    </apex:form>
    <apex:outputPanel styleClass="slds-panel" id="scriptTag">
    <script type="text/javascript">
    
    /*
        * set row level checkboxes based on "all checkbox" state
        */
    var $j = jQuery.noConflict();
    
    //Capture the list of countries in a Array.
    var userNames ;//= ['India', 'USA', 'China','FInland','Norway','Netherlands','England','Ukraine','Russia','Japan','Korea','Burma','Srilanka','Iran','Iceland','Canada','Rome','Australia','Armenia','Albania','Afghanisthan'];
    var queryTerm;
    var donNames;
    var hosNames;    
    //on Document ready
    $j(document).ready(function(){
        
        var cbselect = $j("input[id$=oneSelect]");
        //all row level checkboxes selected
        if(cbselect.filter(':checked').length==0){
            //set "all checkbox" selected
            $j("input[id$=allSelect]").prop('checked', false);
        }
        
        $j("[id$=countryautocomplete]").autocomplete({
            //source : userNames
            //console.log("pc Calling");
            source: function(request, response) {
                queryTerm = request.term;
                CampaignManageUsersControl.searchUser(request.term,'{!campaignID}','Property', function(result, event){
                    if(event.type == 'exception') {
                        alert(event.message);
                    } else {
                        userNames = result;
                        response(userNames);
                    }
                });
            },
            
            });
        
            $j("[id$=hosautoComplete]").autocomplete({
            //source : userNames
               
            source: function(request, response) {
                queryTerm = request.term;
                CampaignManageUsersControl.searchUser(request.term,'{!campaignID}','HOS', function(result, event){
                    if(event.type == 'exception') {
                        alert(event.message);
                    } else {
                        hosNames = result;
                        response(hosNames);
                    }
                });
            },
            
            });
            
            $j("[id$=dosautoComplete]").autocomplete({
            //source : userNames
                //console.log("Dos Calling");
            source: function(request, response) {
                queryTerm = request.term;
                CampaignManageUsersControl.searchUser(request.term,'{!campaignID}','DOS', function(result, event){
                    if(event.type == 'exception') {
                        alert(event.message);
                    } else {
                        donNames = result;
                        response(donNames);
                    }
                });
            },
            
            });
        });
    
    
    
    function validations(page){
        //var sDate = dateformat('{!manageHelper.campainRecord.Marketing_Start_Date__c}');
        //var eDate = dateformat('{!manageHelper.campainRecord.Marketing_End_Date__c}');
        //console.log('sDate = '+sDate+';eDate = '+eDate); 
        
        var cbs = $j("input[id$=oneSelect]");
        var isdatesPresent = true;
        if(cbs.filter(':checked').length == 0){
            alert('Please select at least one user');
            return false;
        }
       /*  
       $j(".dataCell input:checked").each(function () {
           //console.log($j(this).closest('.dataRow').find(".startDate"));
            var startDate = $j(this).closest('tr').find(".startDate").val();
            var endtDate = $j(this).closest('tr').find(".endDate").val();
            console.log(startDate+','+endtDate);
            console.log(toDateVal(startDate)+','+toDateVal(endtDate));
            if(startDate == '' || endtDate == ''){
                isdatesPresent = false;
                alert('Start and End dates are required for selected user');
                return false;
            }else if (sDate != null && eDate != null){
                if(toDateVal(startDate) > toDateVal(endtDate) ){
                    isdatesPresent = false;
                    alert('Start date must be between less than End date.');
                    return false;
                }
                else if(sDate > toDateVal(startDate) || eDate < toDateVal(startDate)) {
                    isdatesPresent = false;
                    alert('Start Date must be between Marketing Start and End dates.');
                    return false;
                } 
                else if(sDate > toDateVal(endtDate) || eDate < toDateVal(endtDate)) {
                    isdatesPresent = false;
                    alert('End Date must be between Marketing Start and End dates.');
                    return false;
                }
            }
        });
        
        window.open(page+'?ids=0059E000000Rr9G 0059E000000RiZo','_blank', 'toolbar=yes, scrollbars=yes, resizable=yes, top=500, left=500, width=400, height=400')
        */
        return isdatesPresent;
        
    }
    
    function toDateVal(dateStr) {
        var parts = dateStr.split("/");
        return new Date(parts[2], parts[1] - 1, parts[0]);
    }
    
    function dateformat(input){
        if (!(input == '' || input == null || input == 'undefined')){
            var year = input.slice(-4),
            month = ['Jan','Feb','Mar','Apr','May','Jun',
                     'Jul','Aug','Sep','Oct','Nov','Dec'].indexOf(input.substr(4,3))+1,
            day = input.substr(8,2);
        
            var output = year + '-' + (month<10?'0':'') + month + '-' + day;
            var dateValue = new Date(year, month - 1, day);
            return dateValue;
        } else return null;
    }
    
    function toggleSelectAll(checkbox){
        
        //all checkbox is selected
        if(checkbox.checked){
            //set all row level checkboxes selected
            $j( "input[class$=oneSelect]" ).prop('checked', true);
        }
        else{
            //set all row level checkboxes de-selected
            $j( "input[class$=oneSelect]" ).prop('checked', false);
        }
    }
    
    function toggleSelectAllAgency(checkbox){
        
        //all checkbox is selected
        if(checkbox.checked){
            //set all row level checkboxes selected
            $j( "input[class$=oneSelectAgent]" ).prop('checked', true);
        }
        else{
            //set all row level checkboxes de-selected
            $j( "input[class$=oneSelectAgent]" ).prop('checked', false);
        }
    }
    /*
    * set "all checkbox" based on state of row level checkboxes
    */
    function toggleItem(checkbox){
        var cbs = $j("input[class$=oneSelect]");
        //all row level checkboxes selected
        if(cbs.filter(':not(:checked)').length==0){
            //set "all checkbox" selected
            $j("input[id$=allSelect]").prop('checked', true);
        }
        else{
            //set "all checkboxes" de-selected
            $j("input[id$=allSelect]").prop('checked', false);
        }
    }
    
    /*
    * set "all checkbox" based on state of row level checkboxes
    */
    var cbs = $j("input[class$=oneSelectAgent]");
    //all row level checkboxes selected
    if(cbs.filter(':not(:checked)').length==0){
        //set "all checkbox" selected
        $j("input[id$=allSelectAgency]").prop('checked', true);
    }
    function toggleItemAgency(checkbox){
        var cbs = $j("input[class$=oneSelectAgent]");
        //all row level checkboxes selected
        if(cbs.filter(':not(:checked)').length==0){
            //set "all checkbox" selected
            $j("input[id$=allSelectAgency]").prop('checked', true);
        }
        else{
            //set "all checkboxes" de-selected
            $j("input[id$=allSelectAgency]").prop('checked', false);
        }
    }
    
    function confirmAction(promptText){
        var r=confirm(promptText)
        if (r==true){ return true; }
        else{ return false; }
    }
    
    </script>
    </apex:outputPanel>
</apex:page>