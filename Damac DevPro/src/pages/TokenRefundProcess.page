<!-- Class Functionality: Controller class for TokenRefundProcess vf page
 *
 * Revision History: 
 *
 * Version     Author                Date             Description
 * 1.1         Vivek Shinde          10/08/2017       Initial Draft
 -->
<apex:page controller="TokenRefundProcessController">
    <apex:includeScript value="{!$Resource.jquery191min}"/> 
    <apex:includeScript value="{!$Resource.jquery191ui}"/> 
    <apex:includeScript value="{!$Resource.jquery191blockui}"/>
    
    <style>
        .homeTab .tertiaryPalette, .individualPalette .homeBlock .tertiaryPalette, .layoutEdit .individualPalette .homeBlock .tertiaryPalette {
            background-color: #007bb4;
            border-color: #cfeef8;
        }
    </style>
    
    <script>
    
        //function to block the whole page
        function blockPage(){ 
            // salesforce standard image src="/img/loading32.gif" </br></br><h1>Processing...</h1>
            $.blockUI({ message: '<div class="slds"><img height="42" width="42" src="/img/loading32.gif" }"  /></br><h1>please wait...</h1></div>', 
                   css: { 
                   border: 'none', 
                   padding: '15px', 
                   backgroundColor:'white',
                   
                   '-webkit-border-radius': '10px', 
                   '-moz-border-radius': '10px', 
                   opacity: 9
                  } 
            }); 
            return false;
        }
       
   
        //function to unblock the page
        function unblockPage(){
            $.unblockUI();
        }
    </script>
    
    <apex:form id="formId">
        <apex:pageBlock title="Customer Selection">
            <apex:pageBlockSection columns="1">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Select the customer for which token needs to be refunded"/>
                    <apex:outputPanel >
                        <apex:inputField value="{!objBooking.Account__c}"/>
                        <apex:commandButton action="{!getBookingUnits}" rerender="formId" value="Get Booking Units"/>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>
        </apex:pageBlock>
            
        <apex:pageBlock title="Booking Units" rendered="{!IF(lstBookingUnit != NULL && lstBookingUnit.size>0, true, false)}">
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton action="{!getAdditionalDetails}" reRender="formId" value="Get Additional Details"/>
            </apex:pageBlockButtons>
            <apex:pageBlockSection columns="1" >
                <apex:pageBlockTable value="{!lstBookingUnit}" var="objBU">
                    <apex:column headerValue="Select">
                        <apex:inputCheckbox value="{!objBU.blnIsSelected}"/> 
                    </apex:column>
                    <apex:column value="{!objBU.strUnitName}" headerValue="Unit"/>
                    <apex:column value="{!objBU.strPropertyName}" headerValue="Property Name"/>
                    <apex:column value="{!objBU.decToken}" headerValue="Token Amount"/>
                    <apex:column value="{!objBU.decUnitValue}" headerValue="Selling Price"/>
                    <apex:column value="{!objBU.strPropertyStatus}" headerValue="Property Status"/>
                    <apex:column value="{!objBU.strACD}" headerValue="Anticipated Completion Date"/>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>
        
        <apex:pageBlock title="Booking Units Detailed" rendered="{!IF(lstDetailedBookingUnit != NULL && lstDetailedBookingUnit.size>0, true, false)}">
            <apex:pageMessages />
            <!-- <apex:pageBlockButtons location="bottom">
                <apex:commandButton action="{!validateTokenRefund}" reRender="formId" value="Validate Token Refund"/>
            </apex:pageBlockButtons> -->
            <apex:pageBlockSection columns="1" >
                <apex:pageBlockTable value="{!lstDetailedBookingUnit}" var="objBU">
                    <apex:column value="{!objBU.strUnitName}" headerValue="Unit"/>
                    <apex:column value="{!objBU.strPropertyName}" headerValue="Property Name"/>
                    <apex:column value="{!objBU.decToken}" headerValue="Token Amount"/>
                    <apex:column value="{!objBU.strPaymentMethod}" headerValue="Payment Method"/>
                    <apex:column value="{!objBU.decUnitValue}" headerValue="Selling Price"/>
                    <apex:column value="{!objBU.strPropertyStatus}" headerValue="Property Status"/>
                    <apex:column value="{!objBU.strACD}" headerValue="Anticipated Completion Date"/>
                    <apex:column value="{!objBU.strUnitStatus}" headerValue="Unit Status"/>
                    <apex:column value="{!objBU.blnIsBulkDeal}" headerValue="Is Bulk Deal"/>
                    <apex:column value="{!objBU.blnIsURCSigned}" headerValue="Is URC Signed"/>
                    <apex:column value="{!objBU.blnIsOlderThan3Months}" headerValue="Older Than 3 Months"/>
                </apex:pageBlockTable>
                <apex:outputField value="{!objSR.Total_Token_Amount__c}"/>
            </apex:pageBlockSection>
        </apex:pageBlock>
        
        <apex:pageBlock title="Upload Douments" rendered="{!blnShowAttachments}">

            <apex:actionStatus onstart="blockPage()" onstop="unblockPage()" id="blockUI" />  
            <apex:pageBlockButtons location="top">
                <apex:commandButton value="Add Attachment" action="{!goToAttachmentPage}" reRender="formId"/>
            </apex:pageBlockButtons>
        
            <apex:pageBlockButtons location="bottom">
                <apex:commandButton action="{!validateTokenRefund}" reRender="formId" value="Validate Token Refund"/>
            </apex:pageBlockButtons>
                
            <apex:pageBlockSection columns="1" >    
                <apex:pageBlockTable value="{!lstSRattachments}" var="l">
                    <apex:column >
                        <apex:commandLink title="Remove Row" style="width:80px;" type="image/png"  action="{!removeAttachment}" reRender="formId" status="blockUI" >
                            <apex:param name="RemoveSelected" value="{!l.id}" assignTo="{!RemoveSelected}" /> 
                            <apex:image value="{!$Resource.Remove}"  style="height:20px;" />
                        </apex:commandLink>
                    </apex:column>
        
                    <apex:column value="{!l.name}"/>
                    <apex:column value="{!l.SR__c}"/>
                    <apex:column value="{!l.Attachment__c }"/>
                    <apex:column value="{!l.type__c }"/>
                    <apex:column value="{!l.View__c}"/>
                </apex:pageBlockTable>
            </apex:pageBlockSection> 
        </apex:pageBlock>
        
    </apex:form>
</apex:page>