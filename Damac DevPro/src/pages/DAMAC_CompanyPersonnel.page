<apex:page id="DAMAC_CompanyPersonnel" standardController="NSIBPM__Service_Request__c" extensions="DAMAC_CompanyPersonnelCntlr" cache="false" sidebar="false" showheader="{!showHeaderAndSidebar}" applyHtmlTag="{!showHeaderAndSidebar}">
    <link rel="shortcut icon" href="{!URLFOR($Resource.Inquiry_Resources,'assets_inquiry/images/favicon.ico')}" type="image/x-icon"/> 
    <script src="{!URLFOR($Resource.ProcessFlow_resource, 'ProcessFlow/ProcessFlow.js')}"></script>
    <apex:stylesheet value="{!URLFOR($Resource.ProcessFlow_resource, 'ProcessFlow/ProcessFlow.css')}" />

    <style>
        .sidebar-components {
            /*padding-top:20px;
            width: 17.5% !important;;*/
            float: left;
            /*margin-right: 1.5%;*/
            background-color: #f6f6f6;
            padding-left: 1px;
            box-sizing: border-box;
            width: 100%;
        }
        
        td.main-row,
        .sidebar,
        .dashboard-content {
            padding-top: 0px !important;
            vertical-align: top;
        }
        
        td.main-row {
            vertical-align: top;
            width: 230px !important;
            padding: 0;
            border: 1px solid #cbcbcb;
        }
        
        body .bPageTitle {
            padding: 0
        }
        
        .page-title.row h3,
        .page-title.row h4,
        .page-title.row h5 {
            color: #000;
        }
        
        .dashboard-content {
            border: none;
            padding-top: 0px;
            padding-right: 10px;
        }
        
        .noSidebarCell>table.row {
            margin: 0;
        }
        
        .dyncPanel .bPageBlock .pbHeader .pbTitle {
            display: none;
        }
        
        .pageTitle {
            color: #454a50;
            font-size: 18px;
            font-weight: bold;
            margin-top: 35px;
            margin-bottom: 13px;
        }
        
        .pageDescription {
            color: #454a50;
            line-height: 1.5;
            margin-bottom: 13px;
            font-size: 13px;
        }
        /*fixing side spacing*/
        
        .noSidebarCell {
            padding: 0;
        }
        
        .bodyDiv .outerNoSidebar table .sidebarCell {
            padding-right: 1px;
        }
        
        .bodyDiv .outerNoSidebar table .sidebarCell #NavigDiv {
            border-left: 1px solid #cbcbcb;
        }
        
        html body .bPageBlock.brandSecondaryBrd {
            border-top-color: #1ebe93!important;
        }
        
        .hd_div {
            width: 100%;
        }
        
        .popupBackground {
            /* Background color */
            background-color: black;
            opacity: 0.20;
            filter: alpha(opacity=20);
            /* Dimensions */
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 998;
            position: absolute;
        }
        
        .PopupPanel {
            /* Dimensions */
            left: 50%;
            width: 100px;
            //margin-left: -100px;
            border-radius: 15px;
             top: 25%;
            height: 100px;
            margin-top: 200px;
            z-index: 999;
            position: fixed;
        }
        
        .mainTitle {
            font-size: 18px;
        }
        
        .panel-container {
            padding-top: 15px;
            padding-bottom: 15px;
            padding-left: 15px;
            padding-right: 15px;
        }
        
        .right {
            float: right;
        }
        
        .left {
            float: left;
        }
        
        .pbButton {
            padding-top: 10px !important;
            padding-bottom: 10px !important;
        }
    </style>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="{!URLFOR($Resource.AgentPortal_Resources,'assets/css/footable.standalone.min.css')}" />
     <c:Damac_Registration_Override_CSS ></c:Damac_Registration_Override_CSS>
    <apex:actionStatus id="pleasewait" stopText="">
        <apex:facet name="start">
            <div>
                <div class="popupBackground override-bg"></div>
                <div class="PopupPanel">
                    <img src="{!$Resource.Portal_Loading_Image}" />
                </div>
            </div>
        </apex:facet>
    </apex:actionStatus>
   
    <c:Damac_Header rendered="{!showHeaderAndSidebar == false}"></c:Damac_Header>
    <apex:form id="frm">

        <apex:actionfunction name="NavigatePage" action="{!goTopage}" status="pleasewait" rerender="hdnCurrentPageId,MenuComp,MainPnl">
            <apex:param name="NextPageId" value="" assignTo="{!strNavigatePageId}" />
        </apex:actionfunction>
    </apex:form>
    <div class="container-fluid">
        <table class="row page-bg" style="width: 100%;">
            <tbody>
                <tr>
                    <td class="main-row" id="SidebarCell">
                        <div class="main-row sidebar-components">
                            <div id="NavigDiv">
                                <c:DPFSideBarComponent id="MenuComp" curPageId="{!strPageId}" rerender="MainPnl" />
                            </div>
                        </div>
                    </td>
                    <td id="bodyCell" class="panel-container large-12 columns">
                        <div class="pageHeading">
                            <h3 style="display: block; font-size: 18px;">{!pageTitle}</h3>
                        </div>
                        <div id="MainCompDiv">
                            <apex:outputPanel >
                                <apex:form id="theForm">
                                    <apex:pageMessages id="Msg" />
                                    <apex:pageMessage summary="{!instructionMsg}" severity="info" strength="3" escape="false"/> 
                                    <apex:inputhidden id="hdnActionId" value="{!strActionId}" />
                                    <apex:inputhidden value="{!CurrentPageOrder}" id="hdnPageOrder" />
                                    <apex:actionfunction name="InvokeAction" action="{!DynamicButtonAction}" status="pleasewait" rerender="Msg" />
                                    <apex:actionfunction name="NavigatePage" action="{!goTopage}" status="pleasewait" rerender="Msg">
                                        <apex:param name="NextPageId" value="" assignTo="{!strNavigatePageId}" />
                                    </apex:actionfunction>
                                    <apex:pageBlock id="CompanyPersonnelPB">

                                        <apex:pageBlockButtons >
                                            <apex:commandButton styleClass="addNew" value="Add New" action="{!createAmd}" rendered="{!!editMode}" reRender="CompanyPersonnelPB,scriptTag" status="pleasewait" />
                                            <apex:commandButton value="Save" action="{!Save}" rendered="{!editMode}" reRender="CompanyPersonnelPB,theForm,Msg,scriptTag" status="pleasewait" />
                                            <apex:commandButton value="Cancel" action="{!Cancel}" rendered="{!editMode}" reRender="CompanyPersonnelPB,Msg,scriptTag" status="pleasewait" />
                                        </apex:pageBlockButtons>
                                        <apex:pageBlockSection id="NewEditSection" columns="2" rendered="{!editMode}" title="Person Information">
                                            <apex:InputField value="{!currAmnd.Title__c}" />
                                            <apex:pageBlockSectionItem >
                                            
                                            </apex:pageBlockSectionItem>
                                            <apex:inputField value="{!currAmnd.First_Name__c}" required="true" />
                                            <apex:inputField value="{!currAmnd.Last_Name__c}" required="true" />
                                            <apex:inputField value="{!currAmnd.Email__c}" required="true" />
                                            <apex:InputField value="{!currAmnd.ID_Type__c}" required="true"/>
                                            <apex:InputField value="{!currAmnd.ID_Number__c}" required="true"/>
                                                <apex:InputField value="{!currAmnd.ID_Issue_Date__c}" required="true"/>
                                                
                                            <apex:InputField value="{!currAmnd.ID_Expiry_Date__c}" required="true"/>
                                            <apex:InputField value="{!currAmnd.Broker_Card_Number__c}" />
                                            <apex:InputField value="{!currAmnd.Broker_Card_Expiry_Date__c}" />
                                            <apex:InputField value="{!currAmnd.Nationality__c}" required="true"/>
                                            <apex:InputField value="{!currAmnd.Mobile_Country_Code__c}"/>
                                            <apex:InputField value="{!currAmnd.Mobile__c}" styleClass="numberVal" onkeypress="return isNumber(event)"/>
                                            <!-- <apex:InputField value="{!currAmnd.Passport_Number__c}" /> -->
                                            <apex:InputField value="{!currAmnd.Shareholding__c}" />
                                            <apex:InputField value="{!currAmnd.Designation__c}" />

                                        </apex:pageBlockSection>
                                        <apex:pageBlockSection title="Select your reponsibility" rendered="{!editMode}" columns="1">
                                            <apex:pageBlockSectionItem >
                                                <apex:outputLabel value="Owner" />
                                                <apex:outputPanel >
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <apex:InputField value="{!currAmnd.Owner__c}" />
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="(Please mention only the sponsor's name as mentioned in the Trade License/Memorandum document. The shareholding of the owner must be mentioned in the Share holding %)" />
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </apex:outputPanel>
                                            </apex:pageBlockSectionItem>
                                            <apex:pageBlockSectionItem >
                                                <apex:outputLabel value="Portal Administrator" />
                                                <apex:outputPanel >
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <apex:InputField value="{!currAmnd.Portal_Administrator__c}" />
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="(Administrative support to agency, claiming commissions, setting up agent representatives, updating agent documents)" />
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </apex:outputPanel>
                                            </apex:pageBlockSectionItem>
                                            <apex:pageBlockSectionItem >
                                                <apex:outputLabel value="Agent Representative" />
                                                <apex:outputPanel >
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <apex:InputField value="{!currAmnd.Agent_Representative__c}" />
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="(Involved in selling the properties of DAMAC.)" />
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </apex:outputPanel>
                                            </apex:pageBlockSectionItem>
                                            <apex:pageBlockSectionItem >
                                                <apex:outputLabel value="Authorized Signatory" />
                                                <apex:outputPanel >
                                                    <table>
                                                        <tr>
                                                            <td>
                                                                <apex:InputField label="Authorized Signatory" value="{!currAmnd.Authorised_Signatory__c}" />
                                                            </td>
                                                            <td>
                                                                <apex:outputText value="(The Authorised officer should be the Owner or a Manager in the License or a valid POA holder from the Sponsor or Partner(s) of the Agency. The Authorised officer will sign the 'Agency Agreement')" />
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </apex:outputPanel>
                                            </apex:pageBlockSectionItem>
                                        </apex:pageBlockSection>

                                        <apex:pageBlockSection id="amdListSection" title="Company Personnel" rendered="{!AND(amendment_List.Size > 0, !editMode)}" columns="1">

                                            
                                            <apex:pageBlockTable id="table" value="{!amendment_List}" var="amd">   
                                            
                                                <apex:column headervalue="Action" headerClass="action" style="width:100px;text-align:center;">
                                                    
                                                    <apex:commandlink immediate="true" status="pleasewait" value="Edit" style="float:left;cursor:pointer;" styleClass="actionLink" action="{!editAmd}" rerender="CompanyPersonnelPB,scriptTag">
                                                        <apex:param name="comStrId" value="{!amd.Id}" AssignTo="{!currAmdId}" />
                                                    </apex:commandlink>
                                                    <label style="float:left;">&nbsp;|&nbsp;</label>
                                                    <apex:commandlink immediate="true" value="Del" style="cursor:pointer;float:left;" status="pleasewait" styleClass="actionLink" action="{!deleteAmd}" rerender="CompanyPersonnelPB,scriptTag">
                                                        <apex:param name="delStrId" value="{!amd.Id}" AssignTo="{!currAmdId}" />
                                                    </apex:commandlink>

                                                </apex:column>
                                                
                                                <apex:column headerValue="First Name" value="{!amd.First_Name__c}" />
                                                <apex:column headerValue="Last Name" value="{!amd.Last_Name__c}" />
                                                <apex:column headerValue="Shareholding %" value="{!amd.Shareholding__c}" headerClass="mob-responsive" />
                                                <apex:column headerValue="Owner" value="{!amd.Owner__c}" headerClass="mob-responsive" />
                                                <apex:column headerValue="Portal Administrator" value="{!amd.Portal_Administrator__c}" headerClass="mob-responsive" />
                                                <apex:column headerValue="Agent Representative" value="{!amd.Agent_Representative__c}" headerClass="mob-responsive" />
                                                <apex:column headerValue="Authosized Signatory" value="{!amd.Authorised_Signatory__c}" headerClass="mob-responsive"/>       
                                                <!--<apex:column headerValue="Marked For Deletion" value="{!amd.Mark_for_Deletion__c}" headerClass="mob-responsive"/>-->
                                                    
                                                <apex:column headerValue="Email" headerClass="desktop-responsive" value="{!amd.Email__c}" />
                                                <apex:column headerValue="Id Issue Date" headerClass="desktop-responsive" value="{!amd.ID_Issue_Date__c}" />
                                                <apex:column headerValue="ID Type" headerClass="desktop-responsive" value="{!amd.ID_Type__c}" />
                                                <apex:column headerValue="ID Number" headerClass="desktop-responsive" value="{!amd.ID_Number__c}" />
                                                <apex:column headerValue="ID Expiry Date" headerClass="desktop-responsive" value="{!amd.ID_Expiry_Date__c}" />
                                                <apex:column headerValue="Broker Card Number" headerClass="desktop-responsive" value="{!amd.Broker_Card_Number__c}" />
                                                <apex:column headerValue="Broker Card Expiry Date" headerClass="desktop-responsive" value="{!amd.Broker_Card_Expiry_Date__c}" />
                                                <!--<apex:column headerValue="Title" value="{!amd.Title__c}" />-->
                                                <apex:column headerValue="Designation" headerClass="desktop-responsive" value="{!amd.Designation__c}" />
                                                <apex:column headerValue="Mobile Country Code" value="{!amd.Mobile_Country_Code__c}" headerClass="desktop-responsive" />
                                                    <apex:column headerValue="Mobile" value="{!amd.Mobile__c}" headerClass="desktop-responsive" />
                                                <apex:column headerValue="Nationality" value="{!amd.Nationality__c}" headerClass="desktop-responsive"/>    

                                                
                                            </apex:pageBlockTable>

                                            
                                        </apex:pageBlockSection>


                                    </apex:pageBlock>
                                    <div id="DyncPnl" class="dyncPanel" >
                                    <!-- style="{!IF(editMode,'display:none','display')}" -->
                                        <apex:dynamicComponent componentValue="{!DyncPgMainPBBottom}" />
                                    </div>
                                    <apex:inputHidden id="isEditAllowed" value="{!isEditable}"/>
                                    <apex:inputhidden id="hiddenPageIds" value="{!strHiddenPageIds}"/>
                                    <apex:inputHidden id="isDocAllowed" value="{!isDocEditable}"/>
                                    <c:Damac_RegistrationJS ></c:Damac_RegistrationJS>
                                    <script>
                            
                            var hdnMenu;
                            if(document.getElementById('{!$Component.hiddenPageIds}')!=null)
                                hdnMenu = document.getElementById('{!$Component.hiddenPageIds}').value;
                            //hdnMenu = '{!strHiddenPageIds}';
                            var CommunityUsr = '{!isCommunity}';
                            console.log('hdnMenu===>'+hdnMenu);
                            if(hdnMenu!=null && hdnMenu!=''){
                                var hdnsize = hdnMenu.indexOf(",");
                                if(hdnsize>-1){
                                    var hdnPgLst = hdnMenu.split(',');
                                    for(i = 0; i < hdnPgLst.length;i++){
                                        if(document.getElementById(hdnPgLst[i])!=null){
                                            document.getElementById(hdnPgLst[i]).style.display = 'none';
                                        }
                                    }
                                }else{
                                    if(document.getElementById(hdnMenu)!=null)
                                        document.getElementById(hdnMenu).style.display = 'none';
                                }
                            }
    </script>
                                </apex:form>

                            </apex:outputPanel>

                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script src="{!URLFOR($Resource.AgentPortal_Resources,'assets/js/footable.min.js')}"></script>  
    <script>
        function DoAction(ButtonSectionId, IgnoreReqFlds) {
            console.log('ButtonSectionId:' + ButtonSectionId);
            document.getElementById('DAMAC_CompanyPersonnel:theForm:hdnActionId').value = ButtonSectionId;
            InvokeAction();
        }

        function Navigate_To_Page(NextPG,PageOrder){
                            console.log('NextPG==>'+NextPG);
                             console.log('PageOrder==>'+PageOrder);
                                    var CurrentPageOrder;
                                    if(document.getElementById('DAMAC_CompanyPersonnel:theForm:hdnPageOrder')!=null)
                                        CurrentPageOrder = document.getElementById('DAMAC_CompanyPersonnel:theForm:hdnPageOrder').value;
                                     console.log('CurrentPageOrder==>'+CurrentPageOrder);
                                    //&& PageOrder<CurrentPageOrder
                                    if(CurrentPageOrder!=null && PageOrder!=null){
                                        //if ({!editMode}){
                                         //   alert('Please save/Cancel the pending changes to proceed');
                                        //}
                                        //else
                                            NavigatePage(NextPG);
                                        //console.log('page  order should be less than current page order');
                                    }
                                    else{
                                        console.log('This is forward navigation!');
                                    }
                        }
        /* function Navigate_To_Page(NextPG){
                NavigatePage(NextPG);
            }*/
       
    </script>
    <apex:outputPanel id="scriptTag">
        <script>
            $('.desktop-responsive').attr('data-breakpoints','xs sm md lg');
            $('.mob-responsive').attr('data-breakpoints','xs sm');
            $('[id$=amdListSection]').find('.list').footable();
            $(document).ready(function(){
                $('.numberVal').keypress(function(event){
                    return isNumber(event);
                });
            });
        </script>
    </apex:outputPanel>
</apex:page>