<apex:page StandardController="Invoice__c" extensions="ApplyCreditOnInvoicePageExtension">

    <apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" />
    <apex:includeScript value="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.8/js/jquery.tablesorter.min.js" />
    <!-- apex:stylesheet value="https://cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.8/css/theme.bootstrap.css" / -->
    
    <style type="text/css">
        .customPopup {
            background-color: white;
            border-style: solid;
            border-width: 2px;
            left: 20%;
            padding: 10px;
            position: absolute;
            z-index: 9999;
            /* These are the 3 css properties you will need to tweak so the pop 
                            up displays in the center of the screen. First set the width. Then set 
                            margin-left to negative half of what the width is. You can also add 
                            the height property for a fixed size pop up.*/
            width: 600px;
            top: 20%;
        }

       .disabledTextBox {
            background-color: white;
            border: 1px solid;
            color: black;
            cursor: default;
            width: 90px;
            display: table;
            padding: 2px 1px;
            text-align:right;
        }   

        .closeButton {
            float: right;
        }
        
        .tableStyle {
            border-collapse: collapse;
            border-spacing: 0;
            border-bottom: 1px solid #ddd !important;
        }
    </style>
    
    <script>
    //{theme: 'bootstrap'}
        $(document).ready(function()
        {
            $("[id$='creditTable']").tablesorter();
        });
    </script>
    
    <apex:form >
        <apex:pageBlock id="theBlock">
        
        
        <apex:pageblockButtons >
            <apex:commandButton value="Apply Credit" action="{!createCreditLineItem}" reRender="popup" />
            <apex:commandButton value="Refresh" action="{!refreshBlock}" reRender="theBlock" />
            <apex:commandButton value="Back" action="{!backToInvoice}"/>
        </apex:pageblockButtons>
            <apex:pagemessages id="theMsg"></apex:pagemessages>
            <apex:pageBlockSection columns="1">
                <apex:pageBlockTable value="{!creditWraperList}" var="creditWrp" Width="100%" id="creditTable" styleclass="tablesorter">
                    
                    <apex:column styleclass="tableStyle" >
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="" />
                        </apex:facet>
                        <apex:inputCheckbox value="{!creditWrp.isSelected}" onclick="checkOnlyOne({!creditWrp.creditIndex});">
                        </apex:inputCheckbox>
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle" >
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Sr.No" />
                        </apex:facet>
                        {!creditWrp.creditIndex+1}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Number" />
                        </apex:facet>
                        {!creditWrp.credit.Name}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Credit Amt." />
                        </apex:facet>
                        {!creditWrp.credit.Total_Credit_Amount__c}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Credit Amt. Rem."/>
                        </apex:facet>
                        {!creditWrp.credit.Total_Credit_Amount_Remaining__c}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Credit Hours"/>
                        </apex:facet>
                        {!creditWrp.credit.Total_Credit_Hours__c}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Credit Hours Rem."/>
                        </apex:facet>
                        {!creditWrp.credit.Total_Credit_Hours_Remaining__c}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Reason" />
                        </apex:facet>
                        {!creditWrp.credit.Reason__c}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Approval Date"/>
                        </apex:facet>
                            <apex:outputText value="{0, date, MMMM d','  yyyy}">
                                <apex:param value="{!creditWrp.credit.Approval_Date__c}" /> 
                            </apex:outputText>
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Approved by"/>
                        </apex:facet>
                        {!creditWrp.credit.Approved_by__r.Name}
                    </apex:column>
                    
                    <apex:column styleclass="tableStyle">
                        <apex:facet name="header">
                            <apex:outputText styleClass="header" value="Description"/>
                        </apex:facet>
                        {!creditWrp.credit.Description__c}
                    </apex:column>
                                        
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            
            <!-- section to display input fields for credit Line items-->
            <apex:outputPanel id="popup">
            <apex:outputPanel id="lineItemSection" rendered="{!popupFlag}" styleClass="customPopup">
                <apex:pageBlockSection title="Credit Line Item">
                    <apex:inputField value="{!creditLineItemObj.Hours_Credited__c}" id="creditLineItemHrs"/>
                    <apex:inputfield value="{!creditLineItemObj.Amount_Credited__c}" id="creditLineItemAmt"/>
                    <apex:inputField value="{!creditLineItemObj.Credited_Date__c}" />
                    <apex:inputField value="{!creditLineItemObj.Credit_Reason__c}" id="creditLineItemReason" required="true"/>
                </apex:pageBlockSection>
                    <apex:commandButton value="Apply" action="{!onClickApply}" reRender="theBlock" styleClass="closeButton" />
                    <apex:commandButton value="Cancel" action="{!cancelCreate}" reRender="theBlock" styleClass="closeButton" immediate="true"/>
            </apex:outputPanel>
            </apex:outputPanel>
            <!-- apex:actionFunction action="{!onClickApply}" name="createCreditLine" rerender="theBlock"/ -->
            <apex:actionFunction action="{!checkboxValidation}" name="checkboxValidation" rerender="theBlock">
                <apex:param name="indexToCheck" value=""/>
            </apex:actionfunction>
        </apex:pageBlock>        
    </apex:form>
    <script>
        /* function createCreditLineItem() {
            var hrsObj = $("input[id$='creditLineItemHrs']").val();
            var amtObj = $("input[id$='creditLineItemAmt']").val();
            var reasonObj = $("input[id$='creditLineItemReason']").val();
            if((hrsObj== null || hrsObj=="") && (amtObj==null || amtObj=="")){
            
                alert('Either Hours or Amount can be credited.');
            } else {
                createCreditLine();
            }
           
        } creditLineItemObj.Credit__c = creditId;*/
        
        function checkOnlyOne(indexToCheck)
        {        
            checkboxValidation(indexToCheck);
        }
    </script>
</apex:page>