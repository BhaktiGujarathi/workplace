<!-- *************************Details*************************
Page Name             :  SendEmails 
Associated Objects    :  Opportunity 
Associated Class      :  SendEmailsCtr
Details               :  This page shows a pop up message to select the email templates and send emails from Opportunity List View
Any Comment           :  Done
Last modified date    :  16 Feb 2016
*********************************************************** -->

<apex:page standardController="Opportunity"  extensions="SendEmailsCtr" showHeader="false" sidebar="false" >
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <style>
        .myButt{
            height: 22px;
            width: 100px;
        }
        .myButt2{
            height: 22px;
            width: 65px;
        }
        .mySel{}
        .mySel1{}
    </style>
    <script>
        $( document ).ready(function() {
            $('.myButt').click(function() { 
                var v = $('.mySel').val();
                var v1 = $('.mySel1').val();
                                
                if(v=='--None--' || v1=='--None--' ) 
                {  if(v=='--None--'){
                        alert('Please select a Email Template.');
                        return null;
                    }
                    else{
                        alert('Please select a From Email address.');
                        return null;
                    }
                }
                else {
                    SendEmails();
                }
            });
            $('.myButt2').click(function() { 
                window.close();
            });
            
        });
        
        function myFunct(){
            var res = '{!counter} email(s) have been sent.';
            alert(res);
            window.close();
        }
        
    </script>
    <apex:form >
        <apex:actionFunction name="SendEmails" action="{!SendEmails}" oncomplete="alert('{!counter} Email(s) have been sent.'); window.close();" reRender="abc"  /> 
        <center>
            <apex:outputText rendered="{!if(showEmails == false,true,false)}"><h2>No Record selected!! Please select opportunities with Account and Account.Email</h2></apex:outputText>
        </center>
        <apex:pageBlock title="Select Email Template and Send Emails" rendered="{!showEmails}" >
        <table>
            <tr>
                <td width="150" ></td>
                <td> <b>Choose Email Template:</b> </td>
                <td width="200" >
                    <apex:selectList styleClass="mySel" value="{!selectedTemplate}" multiselect="false" size="1" style="width:100%">
                        <apex:selectOptions value="{!templateOptions}"/>
                    </apex:selectList>
                </td>
            
                <td width="150" ></td>
                <td> <b>Choose From Email:</b> </td>
                <td width="200" >
                    <apex:selectList styleClass="mySel1" value="{!selectedEmail}" multiselect="false" size="1" style="width:100%">
                        <apex:selectOptions value="{!FromOptions}"/>
                    </apex:selectList>
                </td>
            </tr>
            <tr height="10" ></tr>
           <!--- <tr>
                <td width="150" ></td>
                <td> <b>Send Email From:</b> </td>
                <td style="width:200px">
                    <apex:selectList styleClass="mySel" value="{!selectedFrom}" multiselect="false" size="1" style="width:100%">
                        <apex:selectOptions value="{!fromOptions}"/>
                    </apex:selectList>
                </td>
            </tr> --->
            <tr height="15px" >
            </tr>
        </table>
        <table>
            <tr>
                <td width="230" ></td>
                <td>
                    <button class="myButt" type="button">Send Emails</button>
                    <button class="myButt2" type="button">Cancel</button>    
                </td>
            </tr>
        </table>
        
        </apex:pageBlock>
    </apex:form>
</apex:page>