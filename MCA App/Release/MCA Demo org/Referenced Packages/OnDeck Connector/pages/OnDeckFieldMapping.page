<apex:page controller="ondeck.OnDeckFieldMappingController" action="{!init}" tabStyle="OnDeck_Field_Mapping__tab">
        
    <style>
        .message {
            margin: 4px 0px !important;
        }
        
        #loader {
            background: #fff url("{!URLFOR($Resource.OnDeck, 'img/status.gif')}") no-repeat scroll center center;
            background-size: 40px 40px;
            opacity: 0.8;
            position: absolute;
            width: 100%;
            height: 400px;
            top: 0;
            left: 0;
            z-index: 1000;         
        }
        
    </style>   
    
    <script>
        function showSimpleDialog(){    
		   var sd = new SimpleDialog("SD"+Dialogs.getNextId(), false);    
		   sd.setTitle("Confirm");    
		   sd.createDialog();     
		   window.parent.sd = sd;   
		   sd.setContentInnerHTML("<img src='/img/msg_icons/warning32.png' style='margin:0 5px;display: inline;float: left;'/>" + 
                      "<div align='center'style='display: inline!important;'> <p >Are you sure you want to change the main object? </br> You may lose some data</p></div>" + 
                      "<p align='center'><br />" +
                      "<button class='btn' onclick='window.parent.sd.hide(); init();'" +
                      "return'>Cancel</button><button class='btn' onclick='window.parent.sd.hide(); loadFields();'>Ok</button></p>");    
		   sd.show();   
		   return sd;   
		}    
    </script>      
    
    
    
    <apex:sectionHeader title="OnDeck Field Mapping" />
    
    <apex:pageMessages />
    
    
    <p style="font-size: 109%;">Map each of your organization's objects/fields to OnDeck fields. These mappings will be used when you send PreApprovals and Submissions to OnDeck API.</p>
    
    <apex:form id="setupForm">
        <apex:actionFunction name="loadFields" action="{!loadFields}" rerender="setupForm"  status="myStatus" />
        <apex:actionFunction name="init" action="{!init}" rerender="mainObjectSection" status="myStatus"/>
        <apex:actionFunction name="reloadEntities" rerender="entities" status="myStatus" />
        
        <apex:actionStatus startText="Loading..." id="myStatus" >
             <apex:facet name="start">
	            <div id="loader" style="height: 100%;" >  </div>
	         </apex:facet>
	    </apex:actionStatus>
	    
        
        <apex:pageBlock title="Salesforce to OnDeck Field Mapping" >
        
            <apex:pageBlockButtons >
                <apex:commandButton value="Cancel" action="{!init}" />
                <apex:commandButton value="Save" action="{!save}" disabled="{!NOT(isAdministrator)}" />
            </apex:pageBlockButtons>
        
            <apex:pageBlockSection columns="1" >
                <apex:pageBlockSectionItem >
                
                    <apex:outputLabel value="Main Object" />

                    <apex:selectList id="mainObjectSection" value="{!mainObject}" size="1" multiselect="false" onchange="showSimpleDialog();" >
                        <apex:selectOptions value="{!mainObjectSelection}" />
                    </apex:selectList>
                    
                </apex:pageBlockSectionItem>
                
            </apex:pageBlockSection> 
            
            <apex:pageBlockSection columns="1" id="reloadFields" rendered="{!mainObjectFields.size > 1}">
                <apex:pageBlockTable id="entities" value="{!entities}" var="e">
                    <apex:column headerValue="OnDeck Field" width="250px">{!e.label}</apex:column>
                    
                    <apex:column headerValue="OnDeck Field Type">
                        <apex:outputText value="{!e.fieldType}" /> 
                    </apex:column>
                    
                    <apex:column headerValue="Salesforce Field" width="500px">
                        <apex:selectList value="{!e.sfdcField}" size="1" multiselect="false" onchange="reloadEntities();">
                            <apex:selectOptions value="{!mainObjectFields}" />
                        </apex:selectList>
                        
                        <apex:selectList value="{!e.relatedObjectField}" size="1" multiselect="false" onchange="reloadEntities();" rendered="{!e.relatedObjectFields.size > 1}">
                            <apex:selectOptions value="{!e.relatedObjectFields}" />
                        </apex:selectList>
                    </apex:column>
                    
                    <apex:column headerValue="Salesforce API Name" style="{!if(e.changed, 'color: #FF6A00;font-weight: bold', '')}">
                        <apex:outputText value="{!e.apiName}"  /> 
                    </apex:column>
                    
                </apex:pageBlockTable>
                
            </apex:pageBlockSection>
        </apex:pageBlock>
        
        
        <apex:pageBlock title="Advanced Options" rendered="{!isAdministrator}">
	        <apex:pageBlockSection >
		        <apex:pageBlockSectionItem >
		            <apex:outputLabel value="Reset Mapping" />
		        
				    <apex:outputPanel layout="block">
				        <apex:commandButton value="Regenerate" action="{!regenerate}"/>
				    </apex:outputPanel>
				</apex:pageBlockSectionItem>
				<apex:pageBlockSectionItem >
				    <img src="/img/msg_icons/info16.png" title="This section is used to regenerate the current mapping in case of upgrades"/>
				    <apex:outputLabel value="This section is used to regenerate the current mapping in case of upgrades" />
				</apex:pageBlockSectionItem>
	        </apex:pageBlockSection>
        </apex:pageBlock>
        
        
    </apex:form>
</apex:page>